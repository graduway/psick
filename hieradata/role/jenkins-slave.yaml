---
psick::pre::windows_classes:
  chocolatey: chocolatey
psick::base::windows_classes:
  packages: psick::packages
  jenkins_slave: role::jenkins_slave
psick::profiles::windows_classes:
  features: psick::windows::features
  registry: psick::windows::registry
  services: psick::windows::services
  puppet: psick::puppet::pe_agent
  reboot: psick::reboot
# FIXME: Why commented? Do we need them?
#  firewall: windows_firewall
#  users: psick::users

psick::packages::resource_default_arguments:
  provider: chocolatey
psick::packages::packages_list:
  - "chocolatey"
  - "tortoisesvn"
  - "putty.install"
  - "git"
  - "visualstudio2017enterprise"
  - "visualstudio2017-workload-webbuildtools"
  - "visualstudio2017-workload-netweb"
  - "googlechrome"
  - "netfx-4.6.1-devpack"
  - "nuget.commandline"
  - "notepadplusplus.install"
  - "nodejs-lts"

# SSH Key for WEB Github sync
role::jenkins_slave::ssh_knownhost_content: ENC[PKCS7,MIIEnQYJKoZIhvcNAQcDoIIEjjCCBIoCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAkrpNuggWlVUqv1+s8N4zdIGqp6JtkPQe86R+OQE0JKX8eUhrD5yk/Qoskwnw1z2BqukJ2fGKxAbTYnXw6IDXQ5BX3LKZJp6FEeETPNeAenqPFVij+KHC5KmlDKd8RDCGNYv02M0QC8w1gTNfZ7tHGTf9wl97pIY58X7HnE2gTDHTollagJmpz7WFb5RVspvEAAtZucEuwlyz4bmP/eJQK4Qj0JbeHveDbbucBAXe3tZGlXFzF+nzqgAmwQDBDxZUH5ow6vik1PUxjw29aSM3yqMJso/wvyY3fE+r//sAioNA6u3/gjCVwVHFB/o71E+s+5d+mkHYk1EfdlChDTwHAzCCA14GCSqGSIb3DQEHATAdBglghkgBZQMEASoEEEyQHx6t2ZrAftIeodjoAGuAggMwYknNKgMxiGYZ9mU5NRz8mQDAICqap1sGS0FTBWIRnqz6sQcaK77HjLR4tUIsRkx9JwZviKxXUVvXqCDCvjScOptx+72e3ZGTDRjJ4DL3HlVYU2gkRdbAusc+Id8Pwm4+WigW8F33BL88kXezPIYIm6roM/ZbzSgGHE+NqJqNCgA78H/upohUxXdIp+VlN0P8QOpg2oDXRbuScMet2AWPFTPG3LDikdNWoc+k40ijrsremaOh45H54xa8jW36jVVBavmI7r3LaqqnehGoavNNuxIzvf1IxwlxTxHMUUafO1dTEKM+qMV2SSB6KkcLegmZtpwCN5JI4kEd3nFOmndaBdH7tX27+V6o6C17LqzjCK3GcyddZDE3k6iXVqEbU1Zy6FCVy/H7sX2/kLU33d3GPILP5Tkq9PBMw7qHBK1+jm+onVWCVSHs1ZnMqCZPnnBA0UasnDpPgcVvNu2L0LiAzRYOGzKhy0w8A/l7YuQcVUvZL2uE8GnLfpN3r4QWk4RAv3idO7o04GrdbpG9stHcYrWPHMyDRuYJxhIX7I0wuLFhrNe0ocMGFNHeVC06YvDdoe3hMj5PqS3zQzVIru70szNiFX9ErvC7+cQjHRNp8JZC/rZUA6xMdXBS7yfzZwlSN6Gao2rfcX59dxeNWJUoAxGlRl4vxM3rdymQRA4QEtZ8gq+LkLNoIrIEwtkGDaMd17+/60XYYwZyB5yxrGtr8qHkKOSdUOipcI/PtbKpFTSvbnDX2oX0GCEnoTfq1CP7fR0cYRi4vFowRfWHBVllgN4+Trw46SAi7G59Z3TrhYlBIdfpJEw1rcIvIwlF1d5ZQk59Fwq/vLSmNXql0JTiRD67lLfcp0lbH5tSwWtfcbrYhKhJTBCqSvfERUK53sC9hnuN1VRhYdhQt+xccBbMr8Ubp3iBrx940it/OXG5o1jVmPhAUIUvzteEzZ3wDU6mHOw7sO0eZigfwOMCG/3Fi/hh+KO3RctZxEE9prGZiK8LTdtwlnrQHWwSf2FCS0/kku6jj6D8udKCM/APkKzr1bnrXo94vchUf6+6qV8wS3HlscGz89PokmKF5TwWsjlN]
role::jenkins_slave::ssh_private_key_content: ENC[PKCS7,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]
role::jenkins_slave::ssh_public_key_content: ENC[PKCS7,MIIC/QYJKoZIhvcNAQcDoIIC7jCCAuoCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAjFjDPHQLLDcp+lVM5Mpa+Pnoq02lmEot4z193Wt4bCNudG6l4nV65Az3XJWUWfNFxguAgzvDA9rbGzCx80r8WtyPr7X/m73nPet5z26r2x602uAw7uby5hkiygBv1vkdVSk/EvqP5ESAi3KDA2WuUcPsiRF03SH5w6UnCpVTgvBBYDMPG95EatJD1Jt437+eFXyEpwU2EKnphkrHBJgNWS/k3kLdaUTZ0ARsBtN8PxXwTd31XVvlvJy0KPAvGwOgLqKIhBdyX/RHtE+6OoNY7b18WkOzoKWyKRNmhHh6WLuSSYocQ5ePYRTG7HFAZ7F7CLAvB+ZMIvBwIC0A4V6WFjCCAb4GCSqGSIb3DQEHATAdBglghkgBZQMEASoEEOZIZ94WymhAk9RqDtTn/CGAggGQFxIBRhptt1kCFx5lOX9Sx3ZdgV1/6+XSRmqS9DKKBFyqeXINqF7ehWXRhrRg3e7OWZMjh1HMTuCG64UQKtyEWSYpwK9CjSFLG8dHR3jofSKep+3EpQxSc5GFJvB3kgJO2F25ajNoPxZ3O7KzCqrvs+Y2qz22OFdVK23QxiuxOCBXt3TRQcsfh5d7Vwk2VeSly7rAZ2LtAYfwM9J603XDCeAR6eMdXkDY58rUV8Y52R8D+PzBr+6QejwnLW1mT4c+NzPaqvQ7kB1Z017+vd3Xay/5bcNjL5f4E1Wo3EJ3xn2fW/YZvSZIaIckLDdJCAvMDV8VKMCLTaiLEwLZzVNOerNoyTq5+Mtl/mZHF6HsmEF8FGF8INcImFhbUaA1jwtD/wv38XJuLcVULsa/1dOJ0agfmctoYKlQ/5ZE3PwumsypXN1vN9a5hHvQZFh7ifsscfxqnHT87fcQLalNIio9f0BWh9OBRnEy7GNY087ci9Jbaq3FrZxZNHk/sMKQpw6VE4j/gKgYv4sCj7zFiqaerA==]
# Useful registry keys: http://www.jasinskionline.com/TechnicalWiki/Useful-Windows-Registry-Keys.ashx?AspxAutoDetectCookieSupport=1
# Windows registry: http://www.forensicswiki.org/wiki/Windows_Registry
# Registry Guide for Windows: http://www.pctools.com/guides/registry/
#
psick::windows::registry::use_defaults: true
apsick::windows::registry::keys:
  'SSL Cipher Suite Order':
    key: 'HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Cryptography\Configuration\SSL\00010002!Functions'
    value: 'TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_DHE_DSS_WITH_AES_128_CBC_SH'
    type: 'dword'

psick::puppet::pe_agent::manage_environment: true
psick::windows::features::use_defaults: true
psick::windows::features::install:
  'file-services':
    ensure: present
  'storage-services':
    ensure: present
  'net-framework-45-core':
    ensure: present
  'was':
    ensure: present
  'was-net-environment':
    ensure: present
  'was-config-apis':
    ensure: present

psick::windows::services::use_defaults: true
psick::windows::services::managed:
  'RemoteRegistry':
    ensure: 'stopped'
    enable: 'manual'
  'Spooler':
    ensure: 'running'
    enable: 'true'
  'TCPIP6':
    ensure: 'stopped'
    enable: 'manual'

# Windows firewall settings.
windows_firewall::profile_state: 'on'
windows_firewall::in_policy: 'AllowInbound'
# FIXME: Why commented? Do we need it?
# windows_firewall::in_policy: 'BlockInbound'
windows_firewall::out_policy: 'AllowOutbound'
windows_firewall::rule_key: 'windows_networks'
# Purge unmanaged firewall rules
windows_firewall::purge_rules: false

# Adding users
psick::users::users_hash:
  antony:
    ensure: present
    comment: 'Antony Gelberg'
  alessandro:
    ensure: present
    comment: 'Alessandro Francheschi'
  shachar:
    ensure: present
    comment: 'Shachar Shapira'

# FireWall rules
windows_networks:
  Remote Desktop - User Mode (TCP-In):
    description: Inbound rule for the Remote Desktop service to allow RDP traffic.
      [TCP 3389]
    application_name: C:\Windows\system32\svchost.exe
    service_name: termservice
    protocol: 6
    local_ports: '3389'
    remote_ports: "*"
    local_addresses: "*"
    remote_addresses: "*"
    direction: 1
    interface_types: All
    enabled: true
    grouping: "@FirewallAPI.dll,-28752"
    profiles: 7
    edge_traversal: false
    action: 1
    edge_traversal_options: 0
  Remote Desktop - User Mode (UDP-In):
    description: Inbound rule for the Remote Desktop service to allow RDP traffic.
      [UDP 3389]
    application_name: C:\Windows\system32\svchost.exe
    service_name: termservice
    protocol: 6
    local_ports: '3389'
    remote_ports: "*"
    local_addresses: "*"
    remote_addresses: "*"
    direction: 1
    interface_types: All
    enabled: true
  TCP/8080:
    description: Inbound rule for [TCP 8080]
    application_name: C:\Windows\system32\svchost.exe
    service_name: termservice
    protocol: 6
    local_ports: '8080'
    remote_ports: "*"
    enabled: true
